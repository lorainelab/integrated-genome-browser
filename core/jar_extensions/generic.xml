<project>
	<import file="../../generic.xml" />
	
	<target name="extra-init">
		<property name="proj.dist"	value="${basedir}/dist"/>
		<condition property="output.jar" value="${output}" >
			<isset property="${output}" />
		</condition>
		<property name="output.jar" value="${project}"/>
	</target>
	
	<target name="compile" depends="init, extra-init">
		<!-- <echo message="${basedir}"/>
		<subant target="compile" genericantfile="../../generic.xml" inheritall="true" >
			<dirset dir="${basedir}"/>
		</subant> -->
		
		<antcall target="extend-bundle" />
	</target>
	
	<target name="extend-bundle" description="extend bundles to bundle dir">
		<available file="${bundle.dir}/${output.jar}--igbext.bnd.jar" property="${project}.present"/>
		<antcall target="extend-bundle-if" />
	</target>
	
	<target name="extend-bundle-if" description="extend and copy lib to bundle dir" unless="${project}.present">
		<mkdir dir="${build.dir}" />
		<my.javac destdir="${build.dir}" />
		
		<available file="${rsrc.dir}" property="${rsrc.dir}.present"/>
		<antcall target="copy_resources" />
		
		<mkdir dir="${proj.dist}" />
		
		
		<jar destfile="${proj.dist}/${output.jar}--igbext.jar" filesetmanifest="merge">
			<manifest>
                <attribute name="Trusted-Library" value="true" />
            </manifest>
			<fileset dir="${build.dir}"/>
			<zipfileset includes="**/*" src="${lib.dir}/${project}.jar"/>
		</jar>
		
		<java jar="${lib.dir}/biz.aQute.bnd.jar" fork="true" dir="${proj.dist}" >
			<arg value="wrap"/>
			<arg value="${output.jar}--igbext.jar"/>
		</java>
		
		<move file="${proj.dist}/${output.jar}--igbext.bar" tofile="${bundle.dir}/${output.jar}--igbext.bnd.jar" filtering="false" />
  	</target>
	
	<target name="copy_resources" if="${rsrc.dir}.present">
		<!-- Necessary to copy binary files separately, as filtering can corrupt them.  See http://ant.apache.org/manual/CoreTasks/copy.html for details. -->
		<copy todir="${build.dir}" filtering="false">
			<fileset dir="${rsrc.dir}"> 
				<include name="**/*.gif"/>
				<include name="**/*.png"/>
			</fileset>
		</copy>	
	</target>
	
	<target name="clean" depends="init, extra-init">
		<delete includeEmptyDirs="true" quiet="true">
			<fileset dir="${build.dir}" />
			<fileset dir="${proj.dist}" />
			<fileset file="${bundle.dir}/${output.jar}--igbext.bnd.jar" />
		</delete>
	</target>
	
	<target name="jar" depends="compile" />
	<target name="test" depends="compile" />
	<target name="compile-tests" depends="compile" />
	<target name="webapp" depends="jar"/>
	<target name="all" depends="jar" />

	<target name="docs" />
	<target name="pmd" />
	<target name="cpd" />
	<target name="findbugs" />
	<target name="clean-manifest" />
	<target name="check-nullness" />
	
</project>

